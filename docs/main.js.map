{"version":3,"file":"main.js","sources":["../src/ImageUploader.tsx","../src/CommonImageWindow.ts","../src/DeleteIcon.tsx","../src/SaveIcon.tsx","../src/CanvasImageWindow.tsx","../src/EditIcon.tsx","../src/ImagePreview.tsx","../src/index.tsx","../src/demo.tsx"],"sourcesContent":["import React, { useRef, useState } from \"react\";\n\nconst createFileURL = (file: File) => window.URL.createObjectURL(file);\n\nconst sendData = (file: File) => {\n  let formData = new FormData();\n  formData.append(\"image_upload[image]\", file);\n\n  fetch(\"http://localhost:3001/image_uploads\", {\n    body: formData,\n    method: \"post\"\n  });\n};\n\nexport default function ImageUploader({ setImageSource }: any) {\n  const fileInput = useRef<HTMLInputElement | null>(null);\n  const [isHovering, setIsHovering] = useState(false);\n\n  const handleImageChange = () => {\n    if (!fileInput.current || !fileInput.current.files) {\n      return;\n    }\n    sendData(fileInput.current.files[0]);\n    setImageSource(createFileURL(fileInput.current.files[0]));\n  };\n\n  let classes = \"drop-area\";\n  if (isHovering) {\n    classes += \" drop-area--hovering\";\n  }\n  return (\n    <div>\n      <div\n        className={classes}\n        onDrop={e => {\n          e.preventDefault();\n          e.stopPropagation();\n          setImageSource(createFileURL(e.dataTransfer.files[0]));\n        }}\n        onDragEnter={e => {\n          e.preventDefault();\n          e.stopPropagation();\n          setIsHovering(true);\n        }}\n        onDragOver={e => {\n          e.preventDefault();\n          e.stopPropagation();\n          setIsHovering(true);\n        }}\n        onDragLeave={e => {\n          e.preventDefault();\n          e.stopPropagation();\n          setIsHovering(false);\n        }}\n      >\n        <label htmlFor=\"uploadInput\">Drop an image or click</label>\n        <input\n          id=\"uploadInput\"\n          ref={fileInput}\n          onChange={handleImageChange}\n          type=\"file\"\n        />\n      </div>\n    </div>\n  );\n}\n","const CONTAINER_WIDTH = 200;\nconst CONTAINER_HEIGHT = 200;\n\nconst getMinScale = (naturalWidth: number, naturalHeight: number) => {\n  return Math.max(\n    CONTAINER_WIDTH / naturalWidth,\n    CONTAINER_HEIGHT / naturalHeight\n  );\n};\n\nconst constrainPosition = (x: number, min: number) =>\n  Math.max(Math.min(x, 0), min);\n\nexport default class CommonImageWindow {\n  private ctx: CanvasRenderingContext2D | null;\n  private imageNaturalSize: {\n    width: number;\n    height: number;\n  };\n  private imageSize: {\n    width: number;\n    height: number;\n  };\n  private imagePosition: {\n    x: number;\n    y: number;\n  };\n  private isPanning: boolean;\n  private isScaling: boolean;\n  private panStart: {\n    x: number;\n    y: number;\n  };\n  private scaleStart: {\n    width: number;\n    height: number;\n    x: number;\n    y: number;\n  };\n  private imagePositionStart: {\n    x: number;\n    y: number;\n  };\n  private onScale: ((scale: number) => void) | null;\n  private image: HTMLImageElement;\n  constructor(\n    canvas: HTMLCanvasElement,\n    imageSource: string,\n    initialDimensions: {\n      left: number;\n      top: number;\n      scaledHeight: number;\n      scaledWidth: number;\n    } | null,\n    imageLoadedCB: () => void\n  ) {\n    this.ctx = canvas.getContext(\"2d\");\n    // Image state\n    this.imageNaturalSize = {\n      width: 0,\n      height: 0\n    };\n    this.imageSize = { width: 0, height: 0 };\n    this.imagePosition = { x: 0, y: 0 };\n\n    // Window state\n    this.isPanning = false;\n    this.isScaling = false;\n    this.panStart = { x: 0, y: 0 };\n    this.scaleStart = { width: 0, height: 0, x: 0, y: 0 };\n    // The position of the image when a pan was started\n    this.imagePositionStart = { x: 0, y: 0 };\n    this.onScale = null;\n\n    this.image = new Image();\n    this.image.src = imageSource;\n\n    this.image.onload = () => {\n      this.imageNaturalSize = {\n        width: this.image.naturalWidth,\n        height: this.image.naturalHeight\n      };\n      const aspectRatio = this.image.naturalWidth / this.image.naturalHeight;\n      if (this.image.naturalWidth >= this.image.naturalHeight) {\n        this.imageSize = {\n          width: CONTAINER_HEIGHT * aspectRatio,\n          height: CONTAINER_HEIGHT\n        };\n      } else {\n        this.imageSize = {\n          width: CONTAINER_WIDTH,\n          height: CONTAINER_WIDTH / aspectRatio\n        };\n      }\n      console.log(initialDimensions);\n      if (initialDimensions) {\n        this.imageSize = {\n          width: initialDimensions.scaledWidth,\n          height: initialDimensions.scaledHeight\n        };\n        this.imagePosition = {\n          x: initialDimensions.left,\n          y: initialDimensions.top\n        };\n      }\n      imageLoadedCB();\n      this.draw();\n    };\n  }\n\n  handleScale(callback: (scale: number) => void) {\n    this.onScale = callback;\n  }\n\n  startPan(event: React.MouseEvent) {\n    this.isPanning = true;\n    this.panStart = {\n      x: event.clientX,\n      y: event.clientY\n    };\n    this.imagePositionStart = {\n      x: this.imagePosition.x,\n      y: this.imagePosition.y\n    };\n  }\n\n  endPan() {\n    this.isPanning = false;\n  }\n\n  pan(event: React.MouseEvent) {\n    if (!this.isPanning) {\n      return;\n    }\n\n    this.imagePosition = {\n      x: constrainPosition(\n        this.imagePositionStart.x + (event.clientX - this.panStart.x),\n        CONTAINER_WIDTH - this.imageSize.width\n      ),\n      y: constrainPosition(\n        this.imagePositionStart.y + (event.clientY - this.panStart.y),\n        CONTAINER_HEIGHT - this.imageSize.height\n      )\n    };\n\n    this.draw();\n  }\n\n  startScale() {\n    this.isScaling = true;\n    this.scaleStart = {\n      x: this.imagePosition.x,\n      y: this.imagePosition.y,\n      width: this.imageSize.width,\n      height: this.imageSize.height\n    };\n  }\n\n  stopScale() {\n    this.isScaling = false;\n  }\n  // factor: percentage as decimal\n  scale(factor: number) {\n    if (\n      factor < getMinScale(this.image.naturalWidth, this.image.naturalHeight)\n    ) {\n      return false;\n    }\n\n    const newWidth = this.image.naturalWidth * factor;\n    const newHeight = this.image.naturalHeight * factor;\n\n    this.imageSize = {\n      width: newWidth,\n      height: newHeight\n    };\n\n    // The ratio of the new width compared to the starting width\n    const scaledFactorX = newWidth / this.scaleStart.width;\n    const scaledFactorY = newHeight / this.scaleStart.height;\n    this.imagePosition = {\n      x: constrainPosition(\n        (this.scaleStart.x - CONTAINER_WIDTH / 2) * scaledFactorX +\n          CONTAINER_WIDTH / 2,\n        CONTAINER_WIDTH - this.imageSize.width\n      ),\n      y: constrainPosition(\n        (this.scaleStart.y - CONTAINER_HEIGHT / 2) * scaledFactorY +\n          CONTAINER_HEIGHT / 2,\n        CONTAINER_HEIGHT - this.imageSize.height\n      )\n    };\n\n    this.draw();\n    if (this.onScale !== null) {\n      this.onScale(factor);\n    }\n    return false;\n  }\n\n  getMinScale() {\n    return getMinScale(\n      this.imageNaturalSize.width,\n      this.imageNaturalSize.height\n    );\n  }\n\n  getImageSize() {\n    return {\n      left: this.imagePosition.x,\n      top: this.imagePosition.y,\n      width: CONTAINER_WIDTH,\n      height: CONTAINER_HEIGHT,\n      scaledWitdh: this.imageSize.width,\n      scaledHeight: this.imageSize.height\n    };\n  }\n\n  draw() {\n    if (!this.ctx) {\n      return;\n    }\n    this.ctx.clearRect(0, 0, CONTAINER_WIDTH, CONTAINER_HEIGHT);\n    this.ctx.drawImage(\n      this.image,\n      this.imagePosition.x,\n      this.imagePosition.y,\n      this.imageSize.width,\n      this.imageSize.height\n    );\n  }\n}\n","import React from \"react\";\n\nexport default function DeleteIcon() {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" width=\"100%\">\n      <path d=\"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z\" />\n      <path d=\"M0 0h24v24H0z\" fill=\"none\" />\n    </svg>\n  );\n}\n","import React from \"react\";\n\nexport default function SaveIcon() {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" width=\"100%\">\n      <path fill=\"none\" d=\"M0 0h24v24H0z\" />\n      <path d=\"M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z\" />\n    </svg>\n  );\n}\n","import { useState, useRef, useEffect } from \"react\";\nimport React from \"react\";\nimport CommonImageWindow from \"./CommonImageWindow\";\nimport DeleteIcon from \"./DeleteIcon\";\nimport SaveIcon from \"./SaveIcon\";\n\nconst CONTAINER_WIDTH = 200;\nconst CONTAINER_HEIGHT = 200;\n\nconst getMinScale = (naturalWidth: number, naturalHeight: number) => {\n  return Math.max(\n    CONTAINER_WIDTH / naturalWidth,\n    CONTAINER_HEIGHT / naturalHeight\n  );\n};\n\ntype CanvasImageWindowProps = {\n  imageSource: string;\n  clearImage: any;\n  setIsEditing: any;\n  setImageDimensions: any;\n  initialDimensions: {\n    scale: number;\n    left: number;\n    top: number;\n    scaledHeight: number;\n    scaledWidth: number;\n  } | null;\n};\nexport default function CanvasImageWindow({\n  imageSource,\n  clearImage,\n  setIsEditing,\n  setImageDimensions,\n  initialDimensions\n}: CanvasImageWindowProps) {\n  const imageEl = useRef<HTMLCanvasElement>(null);\n  const windowEl = useRef(null);\n  const [imageManager, setImageManager] = useState<CommonImageWindow | null>(\n    null\n  );\n  const [imageLoaded, setImageLoaded] = useState(false);\n  const [scale, setScale] = useState(0);\n\n  useEffect(() => {\n    if (!imageEl.current) {\n      return;\n    }\n    const newManager = new CommonImageWindow(\n      imageEl.current,\n      imageSource,\n      initialDimensions,\n      () => {\n        setImageLoaded(true);\n      }\n    );\n    newManager.handleScale((newScale: number) => {\n      setScale(newScale * 100);\n    });\n    if (initialDimensions) {\n      setScale(initialDimensions.scale);\n    }\n    setImageManager(newManager);\n  }, []);\n\n  return (\n    <div\n      style={{\n        position: \"relative\",\n        display: \"flex\",\n        flexDirection: \"column\",\n        width: \"208px\"\n      }}\n    >\n      <div\n        ref={windowEl}\n        className=\"image-window\"\n        style={{\n          width: `${CONTAINER_WIDTH}px`,\n          height: `${CONTAINER_HEIGHT}px`\n        }}\n        onMouseDown={event => {\n          if (!imageManager) {\n            return;\n          }\n          imageManager.startPan(event);\n        }}\n        onMouseUp={event => {\n          if (!imageManager) {\n            return;\n          }\n          imageManager.endPan();\n        }}\n        onMouseLeave={() => {\n          if (!imageManager) {\n            return;\n          }\n          imageManager.endPan();\n        }}\n        onMouseMove={event => {\n          if (!imageManager) {\n            return;\n          }\n          imageManager.pan(event);\n        }}\n      >\n        <canvas ref={imageEl} width={CONTAINER_WIDTH} height={CONTAINER_HEIGHT}>\n          Fallback\n        </canvas>\n      </div>\n      <input\n        className=\"scale-slider\"\n        type=\"range\"\n        min={imageManager ? imageManager.getMinScale() * 100 : 0}\n        max={100}\n        value={scale}\n        onMouseDown={e => {\n          if (!imageManager) {\n            return;\n          }\n          imageManager.startScale();\n        }}\n        onMouseUp={e => {\n          if (!imageManager) {\n            return;\n          }\n          imageManager.stopScale();\n        }}\n        onChange={e => {\n          if (!imageManager) {\n            return;\n          }\n          imageManager.scale(parseFloat(e.target.value) / 100);\n        }}\n      />\n      <button\n        className=\"action-button\"\n        style={{ left: 0 }}\n        onClick={() => clearImage()}\n      >\n        <DeleteIcon />\n      </button>\n      <button\n        className=\"action-button\"\n        style={{ right: 0 }}\n        onClick={() => {\n          if (!imageManager) {\n            return;\n          }\n          setImageDimensions(\n            Object.assign({}, imageManager.getImageSize(), { scale: scale })\n          );\n          setIsEditing(false);\n        }}\n      >\n        <SaveIcon />\n      </button>\n    </div>\n  );\n}\n","import React from \"react\";\n\nexport default function DeleteIcon() {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\">\n      <path d=\"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z\" />\n      <path d=\"M0 0h24v24H0z\" fill=\"none\" />\n    </svg>\n  );\n}\n","import React from \"react\";\nimport EditIcon from \"./EditIcon\";\n\ntype ImagePreviewProps = {\n  imageSource: string;\n  imageDimensions: {\n    scale: number;\n    left: number;\n    top: number;\n    scaledHeight: number;\n    scaledWidth: number;\n  };\n  startEditing: () => void;\n};\nexport default function ImagePreview({\n  imageSource,\n  imageDimensions,\n  startEditing\n}: ImagePreviewProps) {\n  return (\n    <div\n      style={{\n        position: \"relative\",\n        display: \"flex\",\n        flexDirection: \"column\",\n        width: \"208px\"\n      }}\n    >\n      <button\n        className=\"action-button\"\n        style={{ right: 0 }}\n        onClick={() => startEditing()}\n      >\n        <EditIcon />\n      </button>\n      <div\n        style={{\n          position: \"relative\",\n          width: \"200px\",\n          height: \"200px\",\n          overflow: \"hidden\",\n          borderRadius: \"50%\",\n          border: \"4px solid #d8dee9\"\n        }}\n      >\n        <img\n          src={imageSource}\n          draggable={false}\n          style={{\n            position: \"absolute\",\n            top: `${imageDimensions.top}px`,\n            left: `${imageDimensions.left}px`,\n            width: `${imageDimensions.scaledWidth}px`,\n            height: `${imageDimensions.scaledHeight}px`\n          }}\n        />\n      </div>\n    </div>\n  );\n}\n","import React, { useState } from \"react\";\n\nimport ImageUploader from \"./ImageUploader\";\nimport CanvasImageWindow from \"./CanvasImageWindow\";\nimport ImagePreview from \"./ImagePreview\";\nimport EditIcon from \"./EditIcon\";\n\nexport default function ImageCrop() {\n  const [imageSource, setImageSource] = useState<string | null>(null);\n  const [isEditing, setIsEditing] = useState(true);\n  const [imageDimensions, setImageDimensions] = useState<{\n    scale: number;\n    left: number;\n    top: number;\n    scaledHeight: number;\n    scaledWidth: number;\n  } | null>(null);\n\n  if (!isEditing && imageSource !== null && imageDimensions !== null) {\n    return (\n      <ImagePreview\n        imageSource={imageSource}\n        imageDimensions={imageDimensions}\n        startEditing={() => setIsEditing(true)}\n      />\n    );\n  }\n\n  if (imageSource === null) {\n    return (\n      <div>\n        <ImageUploader setImageSource={setImageSource} />\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <CanvasImageWindow\n        imageSource={imageSource}\n        clearImage={() => setImageSource(null)}\n        setIsEditing={setIsEditing}\n        setImageDimensions={setImageDimensions}\n        initialDimensions={imageDimensions}\n      />\n    </div>\n  );\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport ImageCrop from \"./index\";\n\nReactDOM.render(\n  <div>\n    <ImageCrop />\n  </div>,\n  document.getElementById(\"root\")\n);\n"],"names":["useRef","React","CONTAINER_WIDTH","CONTAINER_HEIGHT","useEffect","DeleteIcon","EditIcon"],"mappings":"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"}